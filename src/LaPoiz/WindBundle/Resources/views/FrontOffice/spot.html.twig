{% extends 'LaPoizWindBundle:FrontOffice:base.html.twig' %}


    {% block scriptGraph %}
        <script src="{{ asset('bundles/lapoizgraph/js/moment.min.js') }}"></script>
        <script src="{{ asset('bundles/lapoizgraph/js/spline.js') }}"></script>
        <script src="{{ asset('bundles/lapoizgraph/js/meteoFranceIcon.js') }}"></script>
        <script src="{{ asset('bundles/lapoizgraph/js/Graph.js') }}"></script>
        <script src="{{ asset('bundles/lapoizgraph/js/WindGraph.js') }}"></script>
        <script src="{{ asset('bundles/lapoizgraph/js/LegendGraph.js') }}"></script>
        <script src="{{ asset('bundles/lapoizgraph/js/Legend.js') }}"></script>
        <script src="{{ asset('bundles/lapoizgraph/js/graphSpot.js') }}"></script>
    {% endblock %}

    {% block stylesheets %}
        <link href="{{ asset('bundles/lapoizgraph/css/graphSpot.css') }}" rel="stylesheet" media="screen">
    {% endblock %}

{% block bodyPage %}

<h1>Prévisions météo et détails du spot: {{ spot.nom }}</h1>


    <div class="row">
        <div class="col-sm-12">
            {% from "LaPoizGraphBundle:Wind:graph.html.twig" import graph %}
            {{ graph(spot) }}
        </div>
    </div>

<div class="row">
    <div class="col-sm-6 center-block text-center" heigth="300px">
        <h3 class="titreSVG">Rosace du vent à {{ spot.nom }}</h3>
        {% from "LaPoizWindBundle:BackOffice/Spot/Ajax:rosaceWind.html.twig" import displayRosace %}
        {{ displayRosace("200px","200px") }}



        <script>

            // **************************************
            // ** Gestion de l'orientation du vent **
            // **************************************
            var tabOrientationState = new Array(); // Array with orientation => state, used for rosace wind

            getOrientationDataFromSpot();

            // Récupére les données de l'objet spot et les pousse dans la rosace

            function getOrientationDataFromSpot() {
                // Parcour la liste des WindOrientation
                {% for windOrientation in spot.windOrientation %}
                tabOrientationState["{{ windOrientation.orientation }}"]="{{ windOrientation.state?windOrientation.state:"?" }}";
                {% endfor %}

                svgLoad(tabOrientationState, true);
            }

        </script>

    </div>


    <div class="col-sm-6 centered">
        {% if spot.mareeURL|default is not empty %}

            {% from "LaPoizWindBundle:BothOffice/Spot/Ajax/Maree:graph.html.twig" import graphMaree %}
            {{ graphMaree(spot, "400px","300px" ) }}

            <script>

                // **************************************
                // ** Charge les restrictions de marée **
                // **************************************

                jQuery(document).ready(function() {
                    // Parcour la liste des MareeRestriction
                    {% for mareeRestriction in spot.mareeRestriction %}
                        drawPlotBandGraphMaree({{ mareeRestriction.hauteurMin }},{{ mareeRestriction.hauteurMax }},"{{ mareeRestriction.state }}");
                    {% endfor %}
                });

                function drawPlotBandMareeGraphSpot() {
                    {% for mareeRestriction in spot.mareeRestriction %}
                        drawOnePlotBandMareeGraphSpot({{ mareeRestriction.hauteurMin }},{{ mareeRestriction.hauteurMax }},"{{ mareeRestriction.state }}");
                    {% endfor %}
                }

                // dessine sur le graph princiapl du spot, une restriction de marée
                function drawOnePlotBandMareeGraphSpot(hMin, hMax, state) {
                    $('#meteoGraph').highcharts().yAxis[1].addPlotBand({
                                color: getColorPlotBandForState(state),
                                from: hMin,
                                to: hMax
                            }
                    )
                }


            </script>

        {% endif %}
    </div>

</div>




    <div class="row">

        <div class="col-sm-6">
            <h3>Détail du spot de {{ spot.nom }}</h3>

            {% from "LaPoizWindBundle:FrontOffice/spot:details.html.twig" import detail %}
            {{ detail(spot) }}
        </div>

        <div class="col-sm-6">
            <h3>Explications sur les graphiques</h3>

            {% from "LaPoizWindBundle:FrontOffice/spot:explications.html.twig" import info %}
            {{ info(spot) }}
        </div>
    </div>

{% endblock %}


